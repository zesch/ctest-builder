<ng-container>
  <span cdk-overlay-origin
    #trigger="cdkOverlayOrigin"
    class="token"
    [ngClass]="{'selected': selected}"
    (click)="this.select()">
    {{ this.token | iosview }}
  </span>

  <ng-template cdk-connected-overlay
    [origin]="trigger"
    [open]="this.selected"
    [cdkConnectedOverlayHasBackdrop]="backdrop"
    cdkConnectedOverlayBackdropClass="transparent"
    (backdropClick)="this.close()"
    (detach)="this.close()">
  <mat-card

    fxLayout="column">
    <div #firstRow fxLayout="row" fxLayoutAlign="space-between center">
      <button mat-icon-button
        (click)="decrementIndex()"
        matTooltip="move gap to the left">
        <mat-icon>keyboard_arrow_left</mat-icon>
      </button>

      <span>
        <span *ngIf="this.textEdit; then textEditView; else textShowView;"></span>
        <ng-template #textShowView>
          <span class="bold-on-hover"
            (click)="this.textEdit = true; this.alternativesEdit = false;"
            matTooltip="click to edit text">
            {{ this.tempToken | prompt }}
          </span>
        </ng-template>
        <ng-template #textEditView>
          <mat-form-field *ngIf="this.textEdit" id="textEditInput">
            <input matInput [(ngModel)]="this.tempToken.value" (keyup)="handleTextEditKeyup($event)">
            <button
              mat-icon-button
              matSuffix
              color="primary"
              (click)="this.textEdit = false;"
              matTooltip="close">
              <mat-icon>clear</mat-icon>
            </button>
          </mat-form-field>
        </ng-template>

        <span *ngIf="this.alternativesEdit; then alternativesEditView; else alternativesShowView;"></span>
        <ng-template #alternativesShowView>
            <span class="bold-on-hover" (click)="this.alternativesEdit = true; this.textEdit = false;" matTooltip="click to edit alternatives">{{ this.tempToken | solutions }}</span>
        </ng-template>
        <ng-template #alternativesEditView>
          <mat-form-field *ngIf="this.alternativesEdit">
            <mat-chip-list #solutionChips>
              <mat-chip>{{ this.tempToken.value.substring(this.tempToken.offset, this.tempToken.value.length) }}</mat-chip>
              <mat-chip *ngFor="let solution of this.tempToken.alternatives" [removable]="true" (removed)="removeAlternative(solution)">
                {{solution}}
                <mat-icon matChipRemove>cancel</mat-icon>
              </mat-chip>
              <input placeholder="solutions"
                [matChipInputFor]="solutionChips"
                [matChipInputSeparatorKeyCodes]="alternativesAddKeys"
                [matChipInputAddOnBlur]="true"
                (matChipInputTokenEnd)="addAlternative($event)">
            </mat-chip-list>
            <button
              mat-icon-button
              matSuffix
              color="primary"
              (click)="this.alternativesEdit = false;"
              matTooltip="close">
              <mat-icon>clear</mat-icon>
            </button>
          </mat-form-field>
        </ng-template>
      </span>

      <button mat-icon-button
        (click)="incrementIndex()"
        matTooltip="move gap to the right">
        <mat-icon>keyboard_arrow_right</mat-icon>
      </button>
    </div>

    <div #secondRow fxLayoutAlign="center center">
      <mat-slide-toggle
        [checked]="this.tempToken.gapStatus"
        (change)="this.tempToken.gapStatus = !this.tempToken.gapStatus"
        labelPosition="before"
        matTooltip="toggle gap">
        Gap
      </mat-slide-toggle>
      <button mat-icon-button
        (click)="this.locked = !this.locked"
        matTooltip="toggle lock">
        <mat-icon *ngIf="this.locked">lock</mat-icon>
        <mat-icon *ngIf="!this.locked">lock_open</mat-icon>
      </button>
      <button mat-icon-button
        (click)="delete()"
        matTooltip="delete token">
        <mat-icon>delete_outlined</mat-icon>
      </button>
    </div>

    <mat-divider [inset]="true"></mat-divider>

    <div #thirdRow fxLayoutAlign="center center">
      <button mat-button
        fxFlex="1"
        (click)="apply()"
        matTooltip="apply changes"
        color="primary">
        <mat-icon>done</mat-icon>
      </button>
      <button mat-button
        fxFlex="1"
        (click)="discard()"
        matTooltip="discard changes"
        color="warn">
        <mat-icon>clear</mat-icon>
      </button>
    </div>
  </mat-card>
</ng-template>

</ng-container>
